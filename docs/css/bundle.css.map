{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "..\\..\\App.svelte"
  ],
  "sourcesContent": [
    "<script>\r\n  import { onMount } from \"svelte\";\r\n  import dayjs from \"dayjs\";\r\n  import _ from \"lodash\";\r\n  dayjs.locale(\"fr\");\r\n  import \"../lib/dayjs_custom_locale_fr.js\";\r\n  import Cycles from \"./Cycles.svelte\";\r\n  import { prepData } from \"../lib/prepData.js\";\r\n\r\n  let customCss = \"1_2\";\r\n  let curDate = dayjs().startOf(\"day\");\r\n  let lookAheadPonc = 21;\r\n  let lookAheadReg = 13;\r\n  let dataCycles = [];\r\n  let showData = false;\r\n\r\n  let surcycles = [\r\n    \"Aujourd'hui le cinéma\",\r\n    \"Cinéma bis\",\r\n    \"Cinéma d'avant-garde\",\r\n    \"Séances spéciales\",\r\n    \"Conservatoire des techniques\",\r\n    \"Fenêtre sur les collections\",\r\n    \"Parlons cinéma\",\r\n    \"Archi Vives\",\r\n    \"Ciné-club Jean Douchet\"\r\n  ];\r\n\r\n  let pin;\r\n  pin = {\r\n    type: \"message\",\r\n    title: \"La Cinémathèque française<br>est exceptionnellement fermée\",\r\n    msg: \"Revenez un autre jour.\",\r\n    img:\r\n      \"https://i2.wp.com/www.theculturemap.com/wp-content/uploads/2018/09/cinematheque-francaise-frank-gehry-paris-architecture.jpg\"\r\n  };\r\n  // pin = {\r\n  //   type: \"cycle\",\r\n  //   id: 13005\r\n  // };\r\n\r\n  onMount(async () => {\r\n    let dataPonc = await (await fetch(\r\n      \"https://gist.githubusercontent.com/nltesown/e0992fae1cd70e5c2a764fb369ea6515/raw/cycles.json\"\r\n    )).json();\r\n\r\n    let dataReg = await (await fetch(\r\n      \"https://gist.githubusercontent.com/nltesown/a310518cfa88cd52b13a55f3e737d75f/raw/cycles-ext-2.json\"\r\n    )).json();\r\n\r\n    let dataImg = await (await fetch(\r\n      \"https://gist.githubusercontent.com/nltesown/3da425f30589064cebc6ce13ed2f7d10/raw/cycles-img.json\"\r\n    )).json();\r\n\r\n    // Convertit les chaînes de date en objet dayjs\r\n    dataPonc = _(dataPonc)\r\n      .map(d =>\r\n        _({})\r\n          .assign(d, {\r\n            type: \"cycle\",\r\n            dateFrom: dayjs(d.dateFrom).startOf(\"day\"),\r\n            dateTo: dayjs(d.dateTo).startOf(\"day\")\r\n          })\r\n          .value()\r\n      )\r\n      .value();\r\n\r\n    dataReg = _(dataReg)\r\n      .mapValues(d => {\r\n        return _(d)\r\n          .map(e =>\r\n            _({})\r\n              .assign(e, {\r\n                type: \"cycle\",\r\n                dateFrom: e.dateFrom\r\n                  ? dayjs(e.dateFrom).startOf(\"day\")\r\n                  : undefined,\r\n                dateTo: e.dateTo ? dayjs(e.dateTo).startOf(\"day\") : undefined,\r\n                dates: _.map(e.dates, f => dayjs(f).startOf(\"day\"))\r\n              })\r\n              .value()\r\n          )\r\n          .value();\r\n      })\r\n      .value();\r\n\r\n    // Associe l'URL de l'illustration de cycle ponctuel (Attention : son chemin est `img.img`).\r\n    dataPonc = _(\r\n      _.merge(\r\n        _(dataPonc)\r\n          .groupBy(\"idCycleSite\")\r\n          .mapValues(e => e[0])\r\n          .value(),\r\n        _(dataImg)\r\n          .groupBy(\"idCycleSite\")\r\n          .mapValues(e => e[0])\r\n          .value()\r\n      )\r\n    )\r\n      .map()\r\n      .value();\r\n\r\n    dataCycles = [dataPonc, dataReg];\r\n  });\r\n\r\n  $: curDate;\r\n  $: dataDisplay = prepData(dataCycles, curDate, pin, {\r\n    lookAheadPonc: lookAheadPonc,\r\n    lookAheadReg: lookAheadReg,\r\n    surcycles: surcycles\r\n  });\r\n\r\n  /**\r\n   * incrOrDecrDate\r\n   * Incrémente ou décrémente d'1 jour la date `date`. Utiliser pour gérer l'événement wheel.\r\n   * @param {Object} date dayjs date\r\n   * @param {integer} amount\r\n   * @return {Object} dayjs date\r\n   */\r\n  function incrOrDecrDate(date, amount = 0) {\r\n    if (amount === 0) return date;\r\n    return dayjs(date).add(amount < 0 ? -1 : 1, \"days\");\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .tools {\r\n    position: fixed;\r\n    right: 0;\r\n    bottom: 0;\r\n    margin: 0;\r\n    padding: 4px;\r\n    display: inline-block;\r\n    background-color: #222;\r\n    color: #eee;\r\n    cursor: row-resize;\r\n    font-size: 0.875rem;\r\n  }\r\n\r\n  .tools > select {\r\n    font-size: 0.875rem !important;\r\n    margin: 4px !important;\r\n  }\r\n\r\n  .tools > select > option {\r\n    font-size: 0.875rem !important;\r\n  }\r\n</style>\r\n\r\n<svelte:head>\r\n  <title>{curDate.format('dddd D MMMM YYYY')}</title>\r\n  {#if customCss !== ''}\r\n    <link rel=\"stylesheet\" href=\"css/custom/{customCss}.css\" />\r\n  {/if}\r\n</svelte:head>\r\n\r\n<section style=\"margin-top: 48px;\">\r\n  <div class=\"container\">{curDate.format('dddd D MMMM YYYY')}</div>\r\n</section>\r\n\r\n<Cycles\r\n  on:updatePin={e => {\r\n    pin = e.detail;\r\n  }}\r\n  {dataDisplay}\r\n  showData={!!showData} />\r\n\r\n<!-- Tools -->\r\n<div\r\n  class=\"tools\"\r\n  on:click={() => {\r\n    curDate = dayjs();\r\n  }}\r\n  on:DOMMouseScroll={e => {\r\n    curDate = incrOrDecrDate(curDate, e.deltaY);\r\n    e.preventDefault();\r\n  }}\r\n  on:wheel={e => {\r\n    curDate = incrOrDecrDate(curDate, e.deltaY);\r\n    e.preventDefault();\r\n  }}>\r\n  {curDate.format('YYYY-MM-DD')}\r\n  <select bind:value={customCss}>\r\n    <option value=\"1_0\">1.0</option>\r\n    <option value=\"1_1\">1.1</option>\r\n    <option value=\"1_2\">1.2</option>\r\n  </select>\r\n  <label>\r\n    Voir les données\r\n    <input type=\"checkbox\" bind:checked={showData} />\r\n  </label>\r\n\r\n</div>\r\n"
  ],
  "names": [],
  "mappings": "AA8HE,MAAM,6CAAC,CAAC,AACN,QAAQ,CAAE,KAAK,CACf,KAAK,CAAE,CAAC,CACR,MAAM,CAAE,CAAC,CACT,MAAM,CAAE,CAAC,CACT,OAAO,CAAE,GAAG,CACZ,OAAO,CAAE,YAAY,CACrB,gBAAgB,CAAE,IAAI,CACtB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,UAAU,CAClB,SAAS,CAAE,QAAQ,AACrB,CAAC,AAED,oCAAM,CAAG,MAAM,8BAAC,CAAC,AACf,SAAS,CAAE,QAAQ,CAAC,UAAU,CAC9B,MAAM,CAAE,GAAG,CAAC,UAAU,AACxB,CAAC,AAED,qBAAM,CAAG,qBAAM,CAAG,MAAM,eAAC,CAAC,AACxB,SAAS,CAAE,QAAQ,CAAC,UAAU,AAChC,CAAC"
}